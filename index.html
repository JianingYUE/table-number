<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Interactive 2D Table Map</title>
  <style>
    :root{
      --bg:#0b0d10; --card:#12161b; --muted:#8892a6; --text:#e6edf3; --accent:#6aa6ff; --good:#38d39f; --warn:#ffb86b; --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0a0c10,#0d1117);color:var(--text);font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}

    /* Header & toolbar */
    header{position:sticky;top:0;z-index:6;background:rgba(13,17,23,.92);backdrop-filter:saturate(1.2) blur(8px);border-bottom:1px solid #202632;display:flex;gap:.5rem;flex-wrap:wrap;align-items:center;padding:.6rem .9rem}
    .toolbar{display:flex;gap:.5rem;flex-wrap:wrap;align-items:center;width:100%}
    .toolbar input[type="text"]{min-width:230px}
    .btn, input[type="file"]::file-selector-button, .chip{border:1px solid #303845;background:#12161b;color:var(--text);padding:.48rem .7rem;border-radius:.8rem;cursor:pointer}
    .btn:hover{border-color:#3a4556}
    .btn.primary{background:linear-gradient(180deg,#2a5fff,#1b50e6);border-color:#2c57d0}
    .btn.ghost{background:transparent}
    .btn.warn{background:#312312;border-color:#5a3b13;color:#ffcc88}
    input[type="text"], textarea, select{background:#0f1318;border:1px solid #2a3240;color:var(--text);border-radius:.6rem;padding:.55rem .6rem;outline:none}
    textarea{min-height:84px;resize:vertical}

    /* Layout */
    .wrap{display:grid;grid-template-columns: 1fr 360px;gap:0;border-top:1px solid #161b22;min-height:calc(100vh - 56px)}
    .panel{border-left:1px solid #202632;background:#0d1117;position:relative}

    /* Map area */
    #stage{position:relative;overflow:auto;background:#0b0e13}
    .board{position:relative;margin:12px;border:1px solid #202632;border-radius:16px;min-height:72vh;background:#0c1016;background-size:contain;background-repeat:no-repeat;background-position:center}
    #grid{position:absolute;inset:0;pointer-events:none;background-image: radial-gradient(circle at 1px 1px,#1a2230 1px,transparent 0);background-size:20px 20px;opacity:.35}

    .table-marker{position:absolute;min-width:52px;min-height:52px;display:flex;align-items:center;justify-content:center;padding:6px 10px;border-radius:14px;border:1px solid #2a3240;background:#10151c;box-shadow:0 4px 16px rgba(0,0,0,.35);cursor:pointer;user-select:none;transition:transform .15s ease, box-shadow .15s ease, border-color .2s}
    .table-marker:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.45)}
    .table-marker.selected{border-color:var(--accent);box-shadow:0 0 0 2px rgba(106,166,255,.25)}
    .table-badge{font-weight:700;border-radius:10px;padding:.1rem .45rem;margin-right:.4rem;background:#152032;border:1px solid #243042}
    .marker-name{font-weight:600;max-width:150px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .pulse{box-shadow:0 0 0 2px rgba(56,211,159,.2),0 0 0 6px rgba(56,211,159,.08)}
    .table-marker.dragging .drag-handle{display:block}
    .drag-handle{position:absolute;inset:-6px;border:2px dashed #304055;border-radius:16px;display:none}

    /* Side editor */
    .panel h3{margin:16px;font-size:16px}
    .form{display:flex;flex-direction:column;gap:.6rem;padding:0 16px 16px}
    .form .row{display:grid;grid-template-columns:1fr;gap:.5rem}
    .photo{width:100%;aspect-ratio: 4/3; background:#0f1318;border:1px dashed #344055;border-radius:12px;display:grid;place-items:center;overflow:hidden}
    .photo img{width:100%;height:100%;object-fit:cover}

    .items{display:flex;flex-wrap:wrap;gap:.4rem}
    .chip{display:inline-flex;gap:.35rem;align-items:center}
    .chip .x{font-weight:700;opacity:.7}
    .muted{color:var(--muted)}

    .list{max-height:220px;overflow:auto;border-top:1px solid #202632;padding:8px 16px}
    .list .match{padding:6px 8px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;border:1px solid #243042;margin-bottom:6px}

    .foot{position:absolute;bottom:0;left:0;right:0;padding:10px 16px;border-top:1px solid #202632;display:flex;gap:.5rem}
    .foot .sp{flex:1}

    .hint{padding:10px 16px;color:#a6b2c0;border-top:1px solid #202632}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,monospace;background:#12161b;padding:.1rem .35rem;border-radius:6px;border:1px solid #202632}

    /* Mobile enhancements */
    .mobile-toggle{display:none}
    @media (max-width: 900px){
      .wrap{grid-template-columns:1fr}
      #stage{height:calc(100vh - 56px)}
      .board{min-height:60vh;margin:8px}
      .panel{position:fixed;left:0;right:0;bottom:0;height:60vh;border-left:none;border-top:1px solid #202632;border-radius:16px 16px 0 0;transform:translateY(100%);transition:transform .25s ease;z-index:7}
      .panel.open{transform:translateY(0)}
      .foot{padding-bottom:calc(10px + env(safe-area-inset-bottom))}
      .toolbar{overflow:auto;white-space:nowrap;width:100%}
      .toolbar > *{flex:0 0 auto}
      .toolbar input[type="text"]{min-width:180px}
      .table-marker{min-width:56px;min-height:56px}
      .marker-name{max-width:110px}
      .mobile-toggle{display:block;position:fixed;right:12px;bottom:12px;z-index:8}
    }
  </style>
</head>
<body>
  <header>
    <div class="toolbar">
      <label class="btn ghost">Upload Floorplan<input id="bgFile" type="file" accept="image/*" hidden></label>
      <button id="addTableBtn" class="btn">Add Table</button>
      <button id="toggleEditBtn" class="btn warn" title="Drag markers to reposition">Layout Mode: OFF</button>
      <input id="search" type="text" placeholder="Search items/table/notesâ€¦ (Enter to focus)" />
      <button id="clearSearch" class="btn ghost">Clear</button>
      <button id="exportBtn" class="btn ghost">Export</button>
      <label class="btn ghost">Import<input id="importFile" type="file" accept="application/json" hidden></label>
      <button id="resetBtn" class="btn ghost" title="Reset all data (keep background)">Reset</button>
    </div>
  </header>

  <div class="wrap">
    <main id="stage">
      <div id="board" class="board">
        <div id="grid"></div>
      </div>
    </main>

    <aside class="panel" id="editor">
      <h3>Table Info</h3>
      <div class="form">
        <div class="row"><label>Table No / Name<input id="f-name" type="text" placeholder="e.g. 12 Left or Private Room A"/></label></div>
        <div class="row"><label>Notes<textarea id="f-notes" placeholder="Internal notes, special requirements, etc"></textarea></label></div>
        <div class="row">
          <label>Items (press Enter to add)<input id="f-itemInput" type="text" placeholder="e.g. Birthday cake, Camera, Thermos" /></label>
          <div id="f-items" class="items muted">None</div>
        </div>
        <div class="row">
          <div class="photo" id="photoBox"><span class="muted">No Photo</span></div>
          <label class="btn ghost" style="width:max-content; margin-top:.4rem">Update Photo<input id="f-photo" type="file" accept="image/*" hidden></label>
        </div>
      </div>
      <div class="hint">Tip: In <span class="kbd">Layout Mode</span> you can drag markers. Double-click a marker to quickly edit.</div>
      <div class="foot">
        <button id="saveBtn" class="btn primary">Save</button>
        <button id="deleteBtn" class="btn" style="background:#25161a;border-color:#4a2a32;color:#ff9aa9">Delete Table</button>
        <div class="sp"></div>
        <button id="closeBtn" class="btn ghost">Close</button>
      </div>

      <div class="list" id="resultList"></div>
    </aside>
  </div>

  <button id="togglePanel" class="btn primary mobile-toggle" aria-controls="editor" aria-expanded="false">Edit</button>

<script>
// (JS code remains unchanged from previous full version)
</script>
</body>
</html>
